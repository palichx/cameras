# ะะฑะฝะพะฒะปะตะฝะธะต ะผะตัะฐะฝะธะทะผะฐ ะทะฐะฟะธัะธ ะดะฒะธะถะตะฝะธั

## ะะทะผะตะฝะตะฝะธั ะฒ ะฒะตััะธะธ 2.0

### 1. ะะตะฟัะตััะฒะฝะฐั ะทะฐะฟะธัั ะฟัะธ ะฟัะพะดะพะปะถะฐััะตะผัั ะดะฒะธะถะตะฝะธะธ โ

**ะัะพะฑะปะตะผะฐ:** ะะฐะฟะธัั ะพััะฐะฝะฐะฒะปะธะฒะฐะปะฐัั ะฟะพัะปะต ะฟะตัะธะพะดะฐ ะฟะพััะทะฐะฟะธัะธ, ะดะฐะถะต ะตัะปะธ ะดะฒะธะถะตะฝะธะต ะฟัะพะดะพะปะถะฐะปะพัั.

**ะะตัะตะฝะธะต:** ะะฑะฝะพะฒะปะตะฝะฐ ะปะพะณะธะบะฐ ะดะตัะตะบัะธะธ ะดะฒะธะถะตะฝะธั:

```python
if motion_detected:
    frames_since_motion = 0  # ะกะฑัะพั ััะตััะธะบะฐ
    
    if self.motion_state == "idle":
        # ะะฐัะฐัั ะฝะพะฒัั ะทะฐะฟะธัั
        self._start_motion_recording()
    
    elif self.motion_state == "cooldown":
        # ะะพะทะพะฑะฝะพะฒะธัั ะทะฐะฟะธัั ะตัะปะธ ะดะฒะธะถะตะฝะธะต ะฝะฐัะฐะปะพัั ัะฝะพะฒะฐ
        self._start_motion_recording()
    
    # ะัะตะณะดะฐ ะทะฐะฟะธััะฒะฐัั ะบะฐะดั ะตัะปะธ ะตััั ะดะฒะธะถะตะฝะธะต
    if self.motion_writer:
        self.motion_writer.write(frame)
```

**ะขะตะฟะตัั ัะฐะฑะพัะฐะตั ัะฐะบ:**
- ะะฒะธะถะตะฝะธะต ะพะฑะฝะฐััะถะตะฝะพ โ ะะฐะฟะธัั ะฝะฐัะธะฝะฐะตััั
- ะะฒะธะถะตะฝะธะต ะฟัะพะดะพะปะถะฐะตััั โ ะะฐะฟะธัั ะฟัะพะดะพะปะถะฐะตััั **ะฑะตัะบะพะฝะตัะฝะพ**
- ะะฒะธะถะตะฝะธะต ะฟัะตะบัะฐัะธะปะพัั โ ะะพััะทะฐะฟะธัั N ัะตะบัะฝะด โ ะััะฐะฝะพะฒะบะฐ
- ะะฒะธะถะตะฝะธะต ะฒะพะทะพะฑะฝะพะฒะธะปะพัั ะฒ cooldown โ ะะฐะฟะธัั ะฝะฐัะธะฝะฐะตััั ัะฝะพะฒะฐ

### 2. ะัะพัะผะพัั ะทะฐะฟะธัะตะน ะฒ ะธะฝัะตััะตะนัะต โ

ะะพะฑะฐะฒะปะตะฝ ะฒัััะพะตะฝะฝัะน ะฒะธะดะตะพะฟะปะตะตั ะดะปั ะฟัะพัะผะพััะฐ ะทะฐะฟะธัะตะน ะฟััะผะพ ะฒ ะฑัะฐัะทะตัะต.

**ะะพะทะผะพะถะฝะพััะธ:**
- โถ๏ธ ะะพัะฟัะพะธะทะฒะตะดะตะฝะธะต ะทะฐะฟะธัะตะน ะพะดะฝะธะผ ะบะปะธะบะพะผ
- โธ๏ธ ะะพะปะฝัะน ะบะพะฝััะพะปั ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั (play/pause/seek)
- ๐ ะะตะณัะปะธัะพะฒะบะฐ ะณัะพะผะบะพััะธ
- ๐บ ะะพะปะฝะพัะบัะฐะฝะฝัะน ัะตะถะธะผ
- ๐ฅ ะกะบะฐัะธะฒะฐะฝะธะต ะฒะธะดะตะพ
- โน๏ธ ะะฝัะพัะผะฐัะธั ะพ ะทะฐะฟะธัะธ (ัะฐะทะผะตั, ะดะปะธัะตะปัะฝะพััั, ะดะฐัะฐ)

**ะัะฟะพะปัะทะพะฒะฐะฝะธะต:**

1. ะะตัะตะนะดะธัะต ะฒ ัะฐะทะดะตะป **"ะะฐะฟะธัะธ"**
2. ะะฐะถะผะธัะต ัะธะฝัั ะบะฝะพะฟะบั **โถ๏ธ Play** ะฝะฐ ะปัะฑะพะน ะทะฐะฟะธัะธ
3. ะัะบัะพะตััั ะดะธะฐะปะพะณ ั ะฒะธะดะตะพะฟะปะตะตัะพะผ
4. ะะธะดะตะพ ะฝะฐัะฝะตั ะฒะพัะฟัะพะธะทะฒะพะดะธัััั ะฐะฒัะพะผะฐัะธัะตัะบะธ

**ะะฝัะตััะตะนั ะฒะธะดะตะพะฟะปะตะตัะฐ:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ [ะะฐะทะฒะฐะฝะธะต ะบะฐะผะตัั]          [ะขะธะฟ ะทะฐะฟะธัะธ]    [X] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                โ
โ              ะะธะดะตะพะฟะปะตะตั                        โ
โ         ั ัะปะตะผะตะฝัะฐะผะธ ัะฟัะฐะฒะปะตะฝะธั                โ
โ                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ๐ ะะฐัะฐ ะธ ะฒัะตะผั           ๐พ ะะฐะทะผะตั ัะฐะนะปะฐ      โ
โ โฑ๏ธ ะะปะธัะตะปัะฝะพััั            [ะกะบะฐัะฐัั]           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ

### ะะพะณะธะบะฐ ัะพััะพัะฝะธะน ะทะฐะฟะธัะธ

```
โโโโโโโโโโโ
โ  IDLE   โ โ ะะถะธะดะฐะฝะธะต ะดะฒะธะถะตะฝะธั, ะฑััะตั ะทะฐะฟะพะปะฝัะตััั
โโโโโโฌโโโโโ
     โ Motion detected
     โผ
โโโโโโโโโโโโ
โRECORDING โ โ ะะฐะฟะธัั ะธะดะตั, ะฟะพะบะฐ ะตััั ะดะฒะธะถะตะฝะธะต
โโโโโโฌโโโโโโ
     โ No motion for post_recording_seconds
     โผ
โโโโโโโโโโโโ
โ COOLDOWN โ โ ะะฐะดะตัะถะบะฐ ะฟะตัะตะด ะฝะพะฒัะผ ัะพะฑััะธะตะผ
โโโโโโฌโโโโโโ
     โ Cooldown expired
     โผ
โโโโโโโโโโโ
โ  IDLE   โ
โโโโโโโโโโโ

ะัะพะฑัะน ัะปััะฐะน:
COOLDOWN + Motion detected โ RECORDING (ะฝะตะผะตะดะปะตะฝะฝัะน ะฟะตัะตัะพะด)
```

### ะะทะผะตะฝะตะฝะธั ะฒ ะบะพะดะต

**backend/server.py:**
- ะะฑะฝะพะฒะปะตะฝะฐ ะปะพะณะธะบะฐ ะฒ `_process_frames()` ะดะปั RTSP
- ะะฑะฝะพะฒะปะตะฝะฐ ะปะพะณะธะบะฐ ะฒ `_record_http_mjpeg()` ะดะปั HTTP MJPEG
- ะะฑะฝะพะฒะปะตะฝะฐ ะปะพะณะธะบะฐ ะฒ `_record_http_snapshot()` ะดะปั HTTP Snapshot
- ะะพะฑะฐะฒะปะตะฝะฐ ะพะฑัะฐะฑะพัะบะฐ ะฒะพะทะพะฑะฝะพะฒะปะตะฝะธั ะทะฐะฟะธัะธ ะธะท ัะพััะพัะฝะธั cooldown

**frontend/src/pages/Recordings.js:**
- ะะพะฑะฐะฒะปะตะฝ state `playingRecording` ะธ `showPlayer`
- ะะพะฑะฐะฒะปะตะฝ ะบะพะผะฟะพะฝะตะฝั `Dialog` ั ะฒะธะดะตะพะฟะปะตะตัะพะผ
- ะะพะฑะฐะฒะปะตะฝะฐ ััะฝะบัะธั `handlePlay(recording)`
- ะะพะฑะฐะฒะปะตะฝะฐ ะบะฝะพะฟะบะฐ Play ะดะปั ะบะฐะถะดะพะน ะทะฐะฟะธัะธ
- ะะพะฑะฐะฒะปะตะฝะพ ะพัะพะฑัะฐะถะตะฝะธะต ะผะตัะฐะดะฐะฝะฝัั ะฒ ะฟะปะตะตัะต

### API Endpoints

**ะะพะปััะธัั ะฒะธะดะตะพัะฐะนะป:**
```
GET /api/recordings/{recording_id}
Response: video/mp4 (binary stream)
```

**ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฒ HTML5 video:**
```html
<video controls>
  <source src="${API}/recordings/{recording_id}" type="video/mp4" />
</video>
```

## ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะัะธะผะตั 1: ะะปะธัะตะปัะฝะพะต ัะพะฑััะธะต
```
ะะฒะธะถะตะฝะธะต ะพะฑะฝะฐััะถะตะฝะพ: 10:00:00
โโ ะัะตะดะทะฐะฟะธัั: 5 ัะตะบ (09:59:55 - 10:00:00)
โโ ะะฒะธะถะตะฝะธะต: 2 ะผะธะฝััั (10:00:00 - 10:02:00)
โโ ะะพััะทะฐะฟะธัั: 5 ัะตะบ (10:02:00 - 10:02:05)

ะัะพะณะพ: 2 ะผะธะฝััั 10 ัะตะบัะฝะด ะฒ ะพะดะฝะพะผ ัะฐะนะปะต
```

### ะัะธะผะตั 2: ะัะตััะฒะธััะพะต ะดะฒะธะถะตะฝะธะต
```
ะะฒะธะถะตะฝะธะต #1: 10:00:00 - 10:00:10 (10 ัะตะบ)
โโ ะะพััะทะฐะฟะธัั: 5 ัะตะบ
โโ Cooldown: 2 ัะตะบ

ะะฒะธะถะตะฝะธะต #2: 10:00:15 (ะฒ ะฟะตัะธะพะด cooldown)
โโ ะะฐะฟะธัั ะฒะพะทะพะฑะฝะพะฒะปัะตััั ะะะ ัะฐะทััะฒะฐ!

ะัะพะณะพ: ะะดะฝะพ ะฝะตะฟัะตััะฒะฝะพะต ะฒะธะดะตะพ ะฒะผะตััะพ ะดะฒัั ััะฐะณะผะตะฝัะพะฒ
```

### ะัะธะผะตั 3: ะัะพัะผะพัั ะทะฐะฟะธัะธ
```bash
# 1. ะะพะปััะธัั ัะฟะธัะพะบ ะทะฐะฟะธัะตะน
curl http://localhost:8001/api/recordings

# 2. ะะพัะฟัะพะธะทะฒะตััะธ ะฒ ะฑัะฐัะทะตัะต
# ะัะบัััั: https://your-app.com/recordings
# ะะฐะถะฐัั ะบะฝะพะฟะบั Play ะฝะฐ ะฝัะถะฝะพะน ะทะฐะฟะธัะธ

# 3. ะกะบะฐัะฐัั ัะฐะนะป
curl http://localhost:8001/api/recordings/{id} -o recording.mp4
```

## ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะะพััะตะฑะปะตะฝะธะต ัะตััััะพะฒ ะฟัะธ ะฟัะพัะผะพััะต:
- **RAM:** ~50-100 MB ะฝะฐ ะพัะบััััะน ะฟะปะตะตั
- **Network:** ะะฐะฒะธัะธั ะพั ัะฐะทะผะตัะฐ ัะฐะนะปะฐ (ะพะฑััะฝะพ 1-10 MB/ะผะธะฝ)
- **CPU:** ะะธะฝะธะผะฐะปัะฝะพะต (ะดะตะบะพะดะธัะพะฒะฐะฝะธะต ะฒ ะฑัะฐัะทะตัะต)

### ะะฟัะธะผะธะทะฐัะธั:
- ะะธะดะตะพ ะฟะตัะตะดะฐะตััั ัะตัะตะท streaming (ะฝะต ะทะฐะณััะถะฐะตััั ัะตะปะธะบะพะผ)
- ะัะฐัะทะตั ะบะตัะธััะตั ะฟัะพัะผะพััะตะฝะฝัะต ััะฐะณะผะตะฝัั
- ะะพะดะดะตัะถะบะฐ seek (ะฟะตัะตะผะพัะบะฐ) ะฑะตะท ะฟะตัะตะทะฐะณััะทะบะธ

## ะกะพะฒะผะตััะธะผะพััั

**ะัะฐัะทะตัั ั ะฟะพะดะดะตัะถะบะพะน:**
- โ Chrome/Edge 90+
- โ Firefox 88+
- โ Safari 14+
- โ Opera 76+

**ะคะพัะผะฐัั ะฒะธะดะตะพ:**
- โ MP4 (H.264 + AAC)
- โ WebM (ะฒ ะฑัะดััะธั ะฒะตััะธัั)

## ะะตัะตะฝะธะต ะฟัะพะฑะปะตะผ

### ะะธะดะตะพ ะฝะต ะฒะพัะฟัะพะธะทะฒะพะดะธััั
**ะัะธัะธะฝะฐ:** ะะตะฟะพะดะดะตัะถะธะฒะฐะตะผัะน ะบะพะดะตะบ
**ะะตัะตะฝะธะต:** ะัะฟะพะปัะทัะตััั ััะฐะฝะดะฐััะฝัะน H.264 ะบะพะดะตะบ

### ะะฐะฟะธัั ะฝะต ะพััะฐะฝะฐะฒะปะธะฒะฐะตััั
**ะัะธัะธะฝะฐ:** ะะฒะธะถะตะฝะธะต ะดะตัะตะบัะธััะตััั ะฟะพััะพัะฝะฝะพ
**ะะตัะตะฝะธะต:** 
- ะฃะผะตะฝััะธัั ััะฒััะฒะธัะตะปัะฝะพััั (`motion_sensitivity`)
- ะะฐัััะพะธัั ะทะพะฝั ะดะตัะตะบัะธะธ (`detection_zones`)
- ะฃะฒะตะปะธัะธัั ะฟะพััะทะฐะฟะธัั ะดะปั ะพะฑัะตะดะธะฝะตะฝะธั ัะพะฑััะธะน

### ะะฝะพะณะพ ะผะตะปะบะธั ัะฐะนะปะพะฒ
**ะัะธัะธะฝะฐ:** ะะฐะปะตะฝัะบะธะน cooldown ะฟะตัะธะพะด
**ะะตัะตะฝะธะต:** ะฃะฒะตะปะธัะธัั `motion_cooldown_seconds` ะดะพ 3-5 ัะตะบัะฝะด

### ะัะพะฟััะตะฝะพ ะฝะฐัะฐะปะพ ัะพะฑััะธั
**ะัะธัะธะฝะฐ:** ะะตะดะพััะฐัะพัะฝะฐั ะฟัะตะดะทะฐะฟะธัั
**ะะตัะตะฝะธะต:** ะฃะฒะตะปะธัะธัั `pre_recording_seconds` ะดะพ 7-10 ัะตะบัะฝะด

## Changelog

**2.0.1 (2025-10-14)**
- โ ะัะฟัะฐะฒะปะตะฝะฐ ะปะพะณะธะบะฐ ะฝะตะฟัะตััะฒะฝะพะน ะทะฐะฟะธัะธ ะฟัะธ ะฟัะพะดะพะปะถะฐััะตะผัั ะดะฒะธะถะตะฝะธะธ
- โ ะะพะฑะฐะฒะปะตะฝ ะฒัััะพะตะฝะฝัะน ะฒะธะดะตะพะฟะปะตะตั ะฒ ะธะฝัะตััะตะนั
- โ ะะพะฑะฐะฒะปะตะฝะฐ ะฟะพะดะดะตัะถะบะฐ ะฒะพะทะพะฑะฝะพะฒะปะตะฝะธั ะทะฐะฟะธัะธ ะธะท cooldown
- โ ะฃะปัััะตะฝะพ ะปะพะณะธัะพะฒะฐะฝะธะต ัะพะฑััะธะน ะดะตัะตะบัะธะธ

**2.0.0 (2025-10-14)**
- โ ะะตะฐะปะธะทะพะฒะฐะฝะฐ ะฟัะตะดะทะฐะฟะธัั ั ัะธะบะปะธัะตัะบะธะผ ะฑััะตัะพะผ
- โ ะะตะฐะปะธะทะพะฒะฐะฝะฐ ะฟะพััะทะฐะฟะธัั
- โ ะะพะฑะฐะฒะปะตะฝ cooldown ะผะตะถะดั ัะพะฑััะธัะผะธ
- โ ะะฐัััะฐะธะฒะฐะตะผัะต ะฟะฐัะฐะผะตััั ะดะปั ะบะฐะถะดะพะน ะบะฐะผะตัั

## ะะฐะปัะฝะตะนัะธะต ัะปัััะตะฝะธั

**ะะปะฐะฝะธััะตััั:**
- ๐ ะะธะฝะธะฐัััั ะดะปั ะทะฐะฟะธัะตะน (thumbnails)
- ๐ ะัะตะผะตะฝะฝะฐั ัะบะฐะปะฐ ัะพะฑััะธะน (timeline)
- ๐ ะญะบัะฟะพัั ะผะฝะพะถะตััะฒะฐ ะทะฐะฟะธัะตะน ะฒ ะพะดะธะฝ ัะฐะนะป
- ๐ ะะพะธัะบ ะฟะพ ะฒัะตะผะตะฝะธ ะธ ะดะฐัะต
- ๐ ะคะธะปัััะฐัะธั ะฟะพ ะดะปะธัะตะปัะฝะพััะธ ะทะฐะฟะธัะธ
- ๐ ะะฐะบะตัะฝะพะต ัะบะฐัะธะฒะฐะฝะธะต ะทะฐะฟะธัะตะน
